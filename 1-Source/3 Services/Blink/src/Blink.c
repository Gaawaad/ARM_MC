/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        \file  FileName.c
 *        \brief
 *
 *      \details
 *
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "Blink.h"

/**********************************************************************************************************************
 *  LOCAL MACROS CONSTANT\FUNCTION
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/
extern u8 IntFlage[6][8];
u32 OnTime = _ON_TIME_DEFAULT;
u32 OffTime = _OFF_TIME_DEFAULT;
u32 CountNum = 0;
LED_state LEDState = _OFF;
/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/


void TimerCallBack(void)
{
    if (LEDState == _OFF)
    {
        if (GPT_GetTime(GPT_CH_A1) >= OffTime)
        {
            LEDState = _ON;
            LED_ON();
            GPT_RestTimer(GPT_CH_A1);
        }
    }
    else if (LEDState == _ON)
    {
        if (GPT_GetTime(GPT_CH_A1) >= OnTime)
        {
            LEDState = _OFF;
            LED_OFF();
            GPT_RestTimer(GPT_CH_A1);
        }
    }
}
void ButtonCallBack(void)
{
    if (IntFlage[TIME_ON_UP_BUTTON_PORT][TIME_ON_UP_BUTTON_PIN] == 1)
    {
        OnTime = OnTime + 100;
        if (OnTime > _MAX_TIME)
        {
            OnTime = _MAX_TIME;
        }
    }
    if (IntFlage[TIME_OFF_UP_BUTTON_PORT][TIME_OFF_UP_BUTTON_PIN] == 1)
    {
        OffTime = OffTime + 100;
        if (OffTime > _MAX_TIME)
        {
            OffTime = _MAX_TIME;
        }
    }
    if (IntFlage[TIME_ON_DOWNN_BUTTON_PORT][TIME_ON_DOWNN_BUTTON_PIN] == 1)
    {
        OnTime = OnTime - 100;
        if (OnTime < _MIN_TIME)
        {
            OnTime = _MIN_TIME;
        }
    }
    if (IntFlage[TIME_OFF_DOWNN_BUTTON_PORT][TIME_OFF_DOWNN_BUTTON_PIN] == 1)
    {
        OffTime = OffTime - 100;
        if (OffTime < _MIN_TIME)
        {
            OffTime = _MIN_TIME;
        }
    }
}
void Blink_start(void)
{
    SysCtr_Init();
    Button_Init();
    LED_Init();
    Gpt_Init(GPT_CH_A1, TimerCallBack);
    GPIO_InterruptCallBack(Dio_PORTF, ButtonCallBack);
    GPT_StartTimer(GPT_CH_A1);
}

/**********************************************************************************************************************
 *  END OF FILE: FileName.c
 *********************************************************************************************************************/
